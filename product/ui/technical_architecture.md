_Status: Active • Last-verified: 2025-06-22 • Owner: @frontend_dev_

**Note:** This file focuses on the Streamlit UI. For the end-to-end technical architecture, see [../technical_architecture.md](../technical_architecture.md).

# Technical Architecture: Brand Audit Dashboard UI

## 1. High-Level Overview

The UI is a **multi-page Streamlit app** backed by local Parquet/JSON artefacts generated by the audit packager. All heavy transformation happens offline → UI performs only lightweight aggregations & visualisations.

```
┌──────────────┐   CLI trigger  ┌─────────────────────┐
│ audit_tool   │──────────────▶│   run_packager.py    │──┐
└──────────────┘               └─────────────────────┘  │  writes
                                                       ▼
                                             audit_runs/<run_id>/
                                                  │  Parquet/JSON
                                                  ▼
                                       ┌──────────────────────┐   st.cache
                                       │  DataGateway layer   │◀─────────┐
                                       └──────────────────────┘          │
                                                ▲                       │
                                                │ pandas DataFrames     │
                                                ▼                       │
                                 Streamlit Multi-page App               │
┌───────────────────────────────────────────────────────────────────────┴──────┐
│ 1_Run_Audit.py | 2_Executive.py | … | 9_Raw_Data.py                          │
└──────────────────────────────────────────────────────────────────────────────┘
```

## 2. Core Modules

| Module                 | Responsibility                                                                                           |
| ---------------------- | -------------------------------------------------------------------------------------------------------- |
| **packager.py**        | Consolidate page-level Markdown into Parquet tables (`page_facts`, `validation`, etc.) and JSON summary. |
| **metric_registry.py** | Load `methodology.yaml`; expose criterion metadata & scoring descriptors.                                |
| **data_gateway.py**    | Lazy-load run folders; return ready DataFrames via `st.cache_resource`.                                  |
| **ui_components.py**   | Reusable KPI cards, alert boxes, Plotly wrappers.                                                        |

## 3. Data Model (simplified)

### 3.1 Parquet: `page_facts`

| col            | dtype                   | description |
| -------------- | ----------------------- | ----------- |
| run_id         | string                  |
| persona_id     | string                  |
| page_id        | string hash             |
| url            | string                  |
| tier           | string                  |
| criterion_id   | string                  |
| raw_score      | float                   |
| weighted_score | float                   |
| descriptor     | string (FAIL/WARN/PASS) |

### 3.2 JSON: `run_manifest`

`{ run_id, timestamp, persona_id, yaml_hash, aggregates{...} }`

## 4. Caching Strategy

- **First-level**: DataGateway caches Parquet → DataFrame conversion (`st.cache_resource`).
- **Second-level**: Page functions cache expensive groupbys (`st.cache_data`).

## 5. Routing & Navigation

- Use Streamlit **multipage** pattern (`streamlit run app.py`).
- Sidebar radio sets `st.session_state.active_page` to jump between tabs on small screens.

## 6. Security & Permissions

- Local desktop app → no auth needed. For cloud deploy, wrap behind SSO proxy; do not persist uploaded personas.

## 7. Deployment

- `docker build -f dashboard.Dockerfile .` produces container with poetry + Streamlit + DuckDB.
- `docker run -p 8501:8501 brand-audit-dashboard:latest`.
